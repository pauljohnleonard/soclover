<svg
  *ngIf="!loading"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  [attr.width]="boardWidth"
  [attr.height]="boardHeight"
  transform-origin="0 0"
  [attr.transform]="containerScale"
  (mousemove)="!isTouch ? mouseMove($event) : null"
  (mouseup)="!isTouch ? mouseUp($event) : null"
  (touchmove)="touchMove($event)"
  (touchend)="touchEnd($event)"
  (mousedown)="mouseDown($event)"
  (click)="catchAllClick($event)"
>
  <defs>
    <!--  TOOLS -->
    <g fill="#000000" id="bin" style="cursor: pointer">
      <rect
        x="-7"
        y="-7"
        width="15"
        height="15"
        rx="2"
        fill="transparent"
      ></rect>

      <use
        xlink:href="assets/icons/delete.svg#delete"
        transform="scale(0.5) translate(-11,-11)"
      />
    </g>

    <g id="spin" style="cursor: pointer">
      <rect
        x="-7"
        y="-7"
        width="15"
        height="15"
        rx="2"
        fill="transparent"
      ></rect>
      <use
        xlink:href="assets/icons/rotate_right.svg#rotate_right"
        transform="scale(0.5) translate(-11,-11)"
      />
    </g>

    <!--  BUTTONS -->
    <g id="download">
      <use xlink:href="assets/icons/download.svg#download" />
    </g>

    <g id="thinking">
      <use xlink:href="assets/icons/cognition.svg#cognition" />
    </g>

    <g id="wrong" transform="translate(-11,-11) scale(4) ">
      <use xlink:href="assets/icons/close.svg#close" fill="red" />
    </g>

    <g id="solving">
      <use xlink:href="assets/icons/question_mark.svg#question_mark" />
    </g>

    <g id="upload">
      <use xlink:href="assets/icons/upload.svg#upload" />
    </g>

    <g id="refresh" style="cursor: pointer">
      <use xlink:href="assets/icons/restart.svg#restart" />
    </g>

    <!-- PETAL -->
    <circle id="mycircle" [attr.cx]="cx" cy="0" [attr.r]="rad" fill="#390" />

    <g id="petal">
      <g [attr.transform]="'translate(0, ' + tweakY + ')'">
        <use xlink:href="#mycircle" />
      </g>
      <g [attr.transform]="'translate(0,  -' + tweakY + ')'">
        <use xlink:href="#mycircle" />
      </g>
    </g>

    <g [attr.transform]="petalTextTransform" id="textbox">
      <rect
        x="0"
        y="0"
        fill="#4A1"
        [attr.width]="petalTextWidth"
        [attr.height]="petalTextHeight"
        style="cursor: text"
        rx="5"
      />
    </g>

    <!-- CARDS -->
    <g id="card">
      <rect
        [attr.x]="cardPad"
        [attr.y]="cardPad"
        [attr.width]="cardWidth - cardPad"
        [attr.height]="cardWidth - cardPad"
        [attr.rx]="cardRad"
        fill="#fff"
      />

      <rect
        [attr.x]="cardPad + holeBorder"
        [attr.y]="cardPad + holeBorder"
        [attr.width]="cardWidth - cardPad - holeBorder * 2"
        [attr.height]="cardWidth - cardPad - holeBorder * 2"
        [attr.rx]="cardRad"
        fill="#366e39"
        [attr.style]="focusPlayer ? 'cursor:grab' : 'default'"
      />
    </g>

    <g id="dropZone">
      <rect
        [attr.x]="cardPad"
        [attr.y]="cardPad"
        [attr.width]="cardWidth - cardPad"
        [attr.height]="cardWidth - cardPad"
        [attr.rx]="cardRad"
        fill="#366e39"
      />
    </g>
  </defs>

  <rect width="100%" height="100%" fill="#dcd" />
  <!--    PETALS -->
  <g [attr.transform]="petalMainTranslate">
    <g [attr.transform]="'translate(120 120)'">
      <g transform="rotate(45)">
        <ng-container *ngFor="let petalData of petalDatas">
          <g
            [attr.transform]="petalData.rotate"
            (click)="!focusPlayer ? selectPetal(petalData.i, $event) : null"
          >
            <use xlink:href="#petal" />
            <use
              xlink:href="#textbox"
              [attr.stroke]="focusPetal === petalData.i ? 'black' : null"
              stroke-width="0.3"
            />
            <text
              [attr.x]="petalTextWidth / 2"
              [attr.y]="petalTextHeight / 2"
              [attr.transform]="petalData.transform"
              text-anchor="middle"
              dominant-baseline="middle"
              fill="black"
              [attr.font-size]="clueFontSize"
              font-family="Arial"
              font-weight="600"
            >
              {{ clues[petalData.i] }}
              <tspan
                class="blink-animation"
                *ngIf="focusPetal === petalData.i"
                fill="#fff"
              >
                &#9611;
              </tspan>
            </text>
          </g>
        </ng-container>

        <circle cx="0" cy="0" [attr.r]="rHub" fill="#390" />
      </g>
    </g>

    <g [attr.transform]="'translate(120 120)'">
      <ng-container *ngFor="let slot of dropZones">
        <g
          (mouseup)="focusPlayer && !isTouch ? mouseUpDrop($event, slot) : null"
        >
          <g transform="rotate(45)">
            <g [attr.transform]="zoneTransformSpin(slot)">
              <use
                id="cardDropZone"
                xlink:href="#dropZone"
                [attr.data-slot]="slot"
              />
            </g>
          </g>
        </g>
      </ng-container>

      <ng-container *ngFor="let card of cards; let card_i = index">
        <g
          [attr.transform]="cardTransformPosition(card)"
          (mousedown)="
            focusPlayer && !isTouch ? mouseDownCard($event, card) : null
          "
          (mouseup)="focusPlayer && !isTouch ? mouseUpCard($event) : null"
          (touchstart)="focusPlayer ? touchStartCard($event, card) : null"
        >
          <g transform="rotate(45)">
            <g [attr.transform]="cardTransformSpin(card)">
              <ng-container>
                <use xlink:href="#card" />
              </ng-container>

              <ng-container *ngFor="let word of card.words; let word_i = index">
                <g
                  [attr.transform]="
                    'rotate(' +
                    (word_i + card.guessOrientation) * 90 +
                    ' ' +
                    (cardPad + cardWidth) / 2 +
                    ' ' +
                    (cardPad + cardWidth) / 2 +
                    ') translate(' +
                    (cardPad + cardWidth / 2) +
                    ',' +
                    wordNudgeIn +
                    ')'
                  "
                >
                  <text
                    x="0"
                    y="0"
                    [attr.transform]="wordTransformFlip(card, word_i)"
                    text-anchor="middle"
                    dominant-baseline="middle"
                    fill="black"
                    [attr.font-size]="cardFontSize"
                    font-family="Arial"
                    font-weight="600"
                  >
                    {{ card.words[word_i] }}
                  </text>
                </g>
              </ng-container>

              <use xlink:href="#wrong" *ngIf="card.wrong" />
            </g>
          </g>
        </g>
        <g
          transform="translate(-10,0)"
          *ngIf="
            focusPlayer &&
            card.guessSlot !== undefined &&
            card.guessSlot >= 0 &&
            !card.draggee
          "
        >
          <use
            xlink:href="#bin"
            [attr.x]="tools[card.guessSlot].binX"
            [attr.y]="tools[card.guessSlot].binY"
            (click)="toolClick(card, 'bin')"
          />

          <use
            xlink:href="#spin"
            [attr.x]="tools[card.guessSlot].spinX"
            [attr.y]="tools[card.guessSlot].spinY"
            (click)="toolClick(card, 'spin')"
          />
        </g>
      </ng-container>
    </g>
  </g>
</svg>
